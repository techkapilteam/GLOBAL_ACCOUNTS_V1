<div class="screen-container">
  <div class="screen-card">


    <div class="screen-header d-flex justify-content-between align-items-center">
      <h2>Account Ledger</h2>
    </div>

    <div class="screen-content">
      <div class="container-fluid my-3">


        <!-- <form>
          <div class="card shadow-sm p-3 mb-4">
            <div class="row g-3 align-items-end">

              <div class="col-md-3">
                <label>Ledger</label>
                <ng-select [items]="ledgeraccountslist" bindLabel="pledgername" bindValue="pledgerid"
                  [(ngModel)]="selectedLedger" name="ledger" (change)="ledgerName_Change($event)">
                </ng-select>
              </div>
              <div class="col-md-3">
                <label>Sub Ledger</label>
                <ng-select [items]="filteredSubLedgers" bindLabel="psubledgername" bindValue="psubledgerid"
                  [(ngModel)]="selectedsubledger" name="subledger" (change)="subledgerName_Change($event)"
                  [disabled]="!selectedLedger">
                </ng-select>
              </div>


              <div class="col-md-3">
                <label>From Date</label>
                <input class="form-control" bsDatepicker [(ngModel)]="fromDate" name="fromDate" [bsConfig]="dpConfig" (ngModelChange)="validateDates()"
                  readonly onkeydown="return false">
              </div>

              <div class="col-md-3">
                <label>To Date</label>
                <input class="form-control" bsDatepicker [(ngModel)]="toDate" name="toDate" [bsConfig]="dpConfig" (ngModelChange)="validateDates()"
                  readonly onkeydown="return false">
              </div>


              <div class="col-auto me-3 mt-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" [(ngModel)]="isNarrationChecked" name="narration">
                  <label class="form-check-label">With Narration</label>
                </div>
              </div>
              <div class="col-auto ms-auto mt-2">
                <button type="button" class="btn btn-primary btn-sm" (click)="generateReport()">Generate Report</button>
              </div>
            </div>
          </div>
        </form> -->
        <form [formGroup]="accountLedgerForm" autocomplete="off">

          <div class="section-content">
            <div class="row">

              <div class="col-xl-3 col-md-4 form-group">
                <label class="required-field">Ledger</label>

                <ng-select [items]="ledgeraccountslist" formControlName="pledgerid" bindLabel="pledgername"
                  bindValue="pledgerid" groupBy="pAccounttype" appendTo="Body" placeholder="Select" (change)="onLedgerChange($event)"
                  [searchable]="true" [clearable]="false">
                </ng-select>

                <small class="text-danger" *ngIf="accountLedgerForm.get('pledgerid')?.touched &&
                 accountLedgerForm.get('pledgerid')?.invalid">
                  Ledger is required
                </small>
              </div>

              <div class="col-xl-3 col-md-4 form-group">
                <label>Sub Ledger</label>

                <ng-select [items]="subledgeraccountslist" formControlName="psubledgerid" bindLabel="psubledgername"
                  bindValue="psubledgerid" placeholder="Select" appendTo="Body" [searchable]="true" [clearable]="false">
                </ng-select>
              </div>

              <div class="col-xl-3 col-md-3 form-group">
                <label>From Date</label>
                <input type="text" class="form-control" formControlName="fromDate" bsDatepicker [bsConfig]="dpConfig"
                  readonly>
              </div>

              <div class="col-xl-3 col-md-3 form-group">
                <label>To Date</label>
                <input type="text" class="form-control" formControlName="toDate" bsDatepicker [bsConfig]="dpConfig"
                  readonly>
                  <small class="text-danger" *ngIf="accountLedgerForm.errors?.['dateRangeInvalid']">
                  From Date cannot be greater than To Date
                </small>
              </div>
              

              <div class="col-xl-3 col-md-3 form-group mt-3">
                <input type="checkbox" (change)="checkNarration($event)" id="WithNarration">
                <label for="WithNarration" class="ms-2">
                  With Narration
                </label>
              </div>

              <div class="col-md-9 col-xl-9 text-end">
                <button type="button" class="btn btn-primary" (click)="generateReport()" [disabled]="isLoading">

                  <span *ngIf="!isLoading">Generate Report</span>
                  <span *ngIf="isLoading">
                    <i class="pi pi-spin pi-spinner"></i> Processing...
                  </span>

                </button>
              </div>

            </div>
          </div>

        </form>


        <div class="card shadow-sm" *ngIf="showReport">
          <div class="card-body">

            <div class="d-flex justify-content-end mb-2">
              <button class="btn btn-outline-danger me-2" (click)="pdfOrPrint('Pdf')">
                <i class="fa fa-file-pdf me-1"></i> PDF
              </button>
              <button class="btn btn-outline-success me-2" (click)="exportToExcel()">
                <i class="fa fa-file-excel me-1"></i> Excel
              </button>
              <button class="btn btn-outline-secondary" (click)="pdfOrPrint('Print')">
                <i class="fa fa-print me-1"></i> Print
              </button>
            </div>


            <div class="text-center mb-1 fw-bold fs-5">
              KAPIL CHITS (HYDERABAD) PVT. LTD.
            </div>
            <div class="text-center mb-1">
              Above TVS Showroom, 1st Floor, Opp: R&B Guest House, Old NK-07, Kamareddy, Telangana - 503111
            </div>
            <div class="text-center mb-2 fw-semibold">
              CIN : U65992TG2008PTC060803
            </div>
            <hr>


            <h6 class="text-center fw-bold">
              Account Ledger - ADVICE IN TRANSIT {{ LedgerName }} {{ SubLedgerName ? ' / ' + SubLedgerName : '' }}
            </h6>


            <div class="row mt-2">
              <div class="col-md-6">
                <span class="fw-bold">Between :</span>
                {{ formatDate(fromDate) }} And {{ formatDate(toDate) }}
              </div>
            </div>


            <p-table [value]="gridView" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5,10,20]"
              responsiveLayout="scroll" class="mt-3">

              <ng-template pTemplate="header">
                <tr>
                  <th *ngFor="let col of columns">
                    {{ col.name }}
                  </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row>
                <tr>
                  <td *ngFor="let col of columns">
                    {{ row[col.prop] }}
                  </td>
                </tr>
              </ng-template>

            </p-table>

          </div>
        </div>

      </div>
    </div>
  </div>
</div>