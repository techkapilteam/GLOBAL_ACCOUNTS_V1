<div class="screen-container">
  <div class="screen-card">

    <div class="screen-header d-flex justify-content-between align-items-center">
      <h2>Bank Book</h2>
    </div>

    <!-- <div class="screen-content">
      <div class="container-fluid my-3">


        <form>
          <div class="card shadow-sm p-3 mb-4">
            <div class="row g-3 align-items-end">

              <div class="col-md-3">
                <label>From Date</label>
                <input type="text" class="form-control" bsDatepicker [(ngModel)]="fromDate" name="fromDate" (ngModelChange)="validateDates()"
                  [bsConfig]="dpConfig" readonly onkeydown="return false">
              </div>

              <div class="col-md-3">
                <label>To Date</label>
                <input type="text" class="form-control" bsDatepicker [(ngModel)]="toDate" name="toDate" (ngModelChange)="validateDates()"
                  [bsConfig]="dpConfig" readonly onkeydown="return false">
              </div>

              <div class="col-md-3">
                <label>Bank Name</label>
                <select class="form-control" [(ngModel)]="bankName" name="bankName">
                  <option value="">Select</option>
                  <option>State Bank</option>
                  <option>HDFC Bank</option>
                  <option>ICICI Bank</option>
                </select>
              </div>
              <div class="col-auto me-3">
                <button type="button" class="btn btn-primary btn-sm" (click)="generateReport()">Generate Report</button>
              </div>

            </div>
          </div>
        </form>


        <div class="card shadow-sm" *ngIf="showTable">
          <div class="card-body">

            <div class="d-flex justify-content-end mb-2">
              <button class="btn btn-outline-danger me-2" (click)="pdfOrprint('Pdf')">
                <i class="fa fa-file-pdf me-1"></i> PDF
              </button>

              <button class="btn btn-outline-success" (click)="exportExcel()">
                <i class="fa fa-file-excel me-1"></i> Excel
              </button>
              <button class="btn btn-outline-secondary me-2" (click)="pdfOrprint('Print')">
                <i class="fa fa-print me-1"></i> Print
              </button>
            </div>


            <div class="text-center mb-1 fw-bold fs-5">
              KAPIL CHITS (HYDERABAD) PVT. LTD.
            </div>

            <div class="text-center mb-1">
              Above TVS Showroom, 1st Floor, Opp: R&B Guest House, Old NK-07, Kamareddy
            </div>

            <div class="text-center mb-2 fw-semibold">
              CIN : U65992TG2008PTC060803
            </div>

            <hr>

            <h6 class="text-center fw-bold">
              Bank Book - {{ bankName }}
            </h6>

            <div class="row mt-2">
              <div class="col-md-6">
                <span class="fw-bold">Between :</span>
                {{ formatDate(fromDate) }} And {{ formatDate(toDate) }}
              </div>
            </div>


            <p-table
  [value]="rows"
  [paginator]="true"
  [rows]="10"
  [rowsPerPageOptions]="[5,10,20]"
  responsiveLayout="scroll"
  class="mt-3 p-datatable-gridlines p-datatable-striped">

  <ng-template pTemplate="header">
    <tr>
      <th>Transaction No</th>
      <th>Date</th>
      <th>Narration</th>
      <th class="text-end">Receipts</th>
      <th class="text-end">Payments</th>
      <th class="text-end">Balance</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row>
    <tr>
      <td>{{ row.txnNo }}</td>
      <td>{{ formatDate(row.particulars) }}</td>
      <td>{{ row.narration }}</td>
      <td class="text-end">₹ {{ row.receipts | number:'1.2-2' }}</td>
      <td class="text-end">₹ {{ row.payments | number:'1.2-2' }}</td>
      <td class="text-end">₹ {{ row.balance | number:'1.2-2' }}</td>
    </tr>
  </ng-template>

</p-table>
          </div>
        </div>

      </div>
    </div> -->
    <div class="section-content">
      <div class="container-fluid my-3">
        <form [formGroup]="bankBookForm" autocomplete="off">

          <div class="row">

            <div class="col-md-3">
              <label>From Date</label>
              <input type="text" class="form-control" formControlName="fromDate" bsDatepicker [bsConfig]="dpConfig"
                readonly>
            </div>

            <div class="col-md-3">
              <label>To Date</label>
              <input type="text" class="form-control" formControlName="toDate" bsDatepicker [bsConfig]="dpConfig"
                readonly>
              <small class="text-danger" *ngIf="bankBookForm.errors?.['dateRangeInvalid']">
                From Date cannot be greater than To Date
              </small>
            </div>

            <div class="col-md-3">
              <label>Bank Name</label>
              <select class="form-control" formControlName="pbankname" (change)="onBankChange($event)">
                <option value="">Select</option>
                <option *ngFor="let bank of bankData" [value]="bank.bankAccountId">
                  {{ bank.bankName }}
                </option>
              </select>
            </div>

            <div class="col-md-3 d-flex align-items-end">
              <button type="button" class="btn btn-primary w-100" (click)="getBankBookReports()" [disabled]="loading">
                {{ loading ? 'Processing...' : 'Generate Report' }}
              </button>
            </div>

          </div>
        </form>
      </div>
    </div>


    <div *ngIf="showReport" class="mt-4">

      <div class="d-flex justify-content-end gap-2 mt-3">
        <button class="btn btn-outline-danger btn-sm" (click)="pdfOrPrint('Pdf')">
          <i class="fa fa-file-pdf me-1"></i> PDF
        </button>

        <button class="btn btn-outline-success btn-sm" (click)="export()">
          <i class="fa fa-file-excel me-1"></i> Excel
        </button>
        <button class="btn btn-outline-secondary btn-sm" (click)="pdfOrPrint('Print')">
          <i class="fa fa-print me-1"></i> Print
        </button>
      </div>
      <div class="text-center mb-1 fw-bold fs-5">
        KAPIL CHITS (HYDERABAD) PVT. LTD.
      </div>

      <div class="text-center mb-1">
        Above TVS Showroom, 1st Floor, Opp: R&B Guest House, Old N.K-07, Kamarreddy
      </div>

      <div class="text-center mb-2 fw-semibold">
        CIN: U65992TG2008PTC060803
      </div>


      <p-table [value]="gridView" dataKey="ptransactionno" [paginator]="true" [rows]="10" [responsiveLayout]="'scroll'"
        sortField="ptransactiondate" [sortOrder]="1" [expandedRowKeys]="expandedRows" [showFirstLastIcon]="false">

        <ng-template pTemplate="header">
          <tr>
            <th>Transaction No.</th>
            <th>Particulars</th>
            <th>Narration</th>
            <th class="text-end">Receipts</th>
            <th class="text-end">Payments</th>
            <th class="text-end">Balance</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row>
          <tr>
            <td>
              <a *ngIf="row.ptransactionno" (click)="toggleRow(row)" style="cursor:pointer;">
                {{ row.ptransactionno }}
              </a>
              <span *ngIf="!row.ptransactionno">--NA--</span>
            </td>

            <td>{{ row.pparticulars }}</td>

            <td>{{ row.pdescription || '--NA--' }}</td>

            <td class="text-end">
              <span *ngIf="row.pdebitamount !== 0">
                ₹ {{ row.pdebitamount | number:'1.2-2' }}
              </span>
            </td>

            <td class="text-end">
              <span *ngIf="row.pcreditamount !== 0">
                ₹ {{ row.pcreditamount | number:'1.2-2' }}
              </span>
            </td>

            <td class="text-end">
              <span [ngClass]="{
            'text-danger fw-bold': row.pBalanceType === 'Cr',
            'fw-bold': row.pBalanceType === 'Dr'
          }">
                ₹ {{ row.popeningbal | number:'1.2-2' }} {{ row.pBalanceType }}
              </span>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="rowexpansion" let-row>
          <tr>
            <td colspan="6">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>Ledger Name</th>
                    <th class="text-end">Debit</th>
                    <th class="text-end">Credit</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let d of row.details">
                    <td>{{ d.ledgerName }}</td>
                    <td class="text-end">
                      {{ d.debit | number:'1.2-2' }}
                    </td>
                    <td class="text-end">
                      {{ d.credit | number:'1.2-2' }}
                    </td>
                  </tr>

                  <tr *ngIf="!row.details || row.details.length === 0">
                    <td colspan="3" class="text-center">No details found</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </ng-template>

      </p-table>
    </div>
  </div>
</div>

<style>
  .custom-select-wrapper {
    position: relative;
  }

  .custom-select-wrapper::after {
    content: '▾';
    position: absolute;
    top: 50%;
    right: 12px;
    transform: translateY(-50%);
    pointer-events: none;
    font-size: 16px;
    color: #555;
  }

  .custom-select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    padding-right: 30px;
  }
</style>