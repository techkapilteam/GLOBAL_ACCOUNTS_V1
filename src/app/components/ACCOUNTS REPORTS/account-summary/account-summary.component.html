<div class="mt-2 border rounded shadow-sm bg-white">
  <div class="section-content">
    <div class="screen-card">
      <div class="screen-header mb-3">
        <h2>Account Summary</h2>
      </div>

      <div class="screen-content">
        <form [formGroup]="accountSummaryForm">
  <div class="row">

    <div class="col-xl-2 col-md-2 mt-4">
      <div class="form-check form-check-inline">
        <input type="checkbox"
               class="form-check-input"
               formControlName="asOn"
               (change)="onDateModeChange()" />
        <label class="mt-2">As On</label>
      </div>
    </div>

    <div class="col-xl-2 col-md-2 form-group">
      <label>{{ accountSummaryForm.get('asOn')?.value ? 'Date' : 'From Date' }}</label>
      <input type="text"
             class="form-control"
             bsDatepicker
             [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY',containerClass: 'theme-dark-blue' }"
             formControlName="fromDate"
             readonly />
    </div>

    <div class="col-xl-2 col-md-2 form-group" *ngIf="!selectedDateMode">
      <label>To Date</label>
      <input type="text"
             class="form-control"
             bsDatepicker
             [bsConfig]="{ dateInputFormat: 'DD-MMM-YYYY',containerClass: 'theme-dark-blue' }"
             formControlName="toDate"
             readonly />
    </div>

    <!-- Ledger Multi Select -->
    <div class="col-xl-3 col-md-3 form-group">
      <label class="required-field">Ledger</label>

      <p-multiSelect
      class="form-control"
        [options]="ledgerAccountsList"
        optionLabel="pledgername"
        optionValue="pledgerid"
        formControlName="ledgerId"
        placeholder="Select Ledger"
        display="chip"
        [filter]="true"
        [appendTo]="'body'"
        [maxSelectedLabels]="3"
  selectedItemsLabel="{0} items selected">
      </p-multiSelect>

    </div>

    <div class="col-xl-3 col-md-3 mt-4">
      <button type="button"
              class="btn btn-primary"
              (click)="generateReport()"
              [disabled]="loading">
        <i class="pi pi-spin pi-spinner" *ngIf="loading"></i>
        {{ loading ? 'Processing...' : 'Generate Report' }}
      </button>
    </div>

  </div>
</form>

<hr>


<div *ngIf="gridData.length > 0">

  <div class="d-flex justify-content-end mb-3">
    <button pButton icon="pi pi-file-excel"
            class="p-button-success mr-2"
            (click)="exportExcel()">
    </button>
  </div>

  <p-table
    [value]="gridData"
    [paginator]="true"
    [rows]="10"
    [responsiveLayout]="'scroll'"
    rowGroupMode="subheader"
    groupRowsBy="pparentname"
    sortField="pparentname"
    sortMode="single">

    <ng-template pTemplate="rowgroupheader" let-rowData>
      <tr class="bg-light">
        <td colspan="6">
          <strong>Ledger: {{ rowData.pparentname }}</strong>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>Particulars</th>
        <th>Max Transaction Date</th>
        <th class="text-end">Opening Balance</th>
        <th class="text-end">Debit</th>
        <th class="text-end">Credit</th>
        <th class="text-end">Closing Balance</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr>
        <td>{{ row.paccountname }}</td>
        <td>{{ row.ptransactiondate | date:'dd/MM/yyyy' }}</td>
        <td class="text-end">{{ row.popeningbal }}</td>
        <td class="text-end">
          {{ row.pdebitamount ? (row.pdebitamount | number:'1.2-2') : '' }}
        </td>
        <td class="text-end">
          {{ row.pcreditamount ? (row.pcreditamount | number:'1.2-2') : '' }}
        </td>
        <td class="text-end">{{ row.pclosingbal }}</td>
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr class="font-weight-bold">
        <td colspan="3" class="text-end">Total</td>
        <td class="text-end">{{ totalDebit | number:'1.2-2' }}</td>
        <td class="text-end">{{ totalCredit | number:'1.2-2' }}</td>
        <td></td>
      </tr>
    </ng-template>

  </p-table>

</div>
  </div>
</div>